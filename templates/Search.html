<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search Employee</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 font-serif">

<nav class="bg-white shadow p-4 flex justify-between">
  <h1 class="text-2xl font-bold">SumeetSSG HR Portal</h1>
  <ul class="flex space-x-4">
    <li><a href="{{ url_for('workforce') }}">Workforce</a></li>
    <li><a href="{{ url_for('add_record') }}">Add Record</a></li>
    <li><a href="{{ url_for('search') }}">Search</a></li>
    <li><a href="{{ url_for('logout') }}">Logout</a></li>
  </ul>
</nav>

<div class="max-w-6xl mx-auto p-6 mt-6">
  <div class="mb-4 flex gap-2">
    <input type="text" id="searchNumber" placeholder="Enter Contact Number" maxlength="10" class="border p-2 rounded flex-1">
    <button id="searchBtn" class="px-4 py-2 bg-blue-600 text-white rounded">Search</button>
  </div>

  <div class="overflow-x-auto hidden" id="resultsContainer">
    <table class="min-w-full border">
      <thead class="bg-gray-200">
        <tr>
          <th>Name</th>
          <th>Applied Position</th>
          <th>Status</th>
          <th>Contact No1</th>
          <th>Contact No2</th>
          <th>Resume</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="resultsBody"></tbody>
    </table>
  </div>
</div>

<script>
const editableCols = ["applied_position","status","contact_no1","contact_no2"];

document.getElementById("searchBtn").addEventListener("click",()=>{
  const num = document.getElementById("searchNumber").value.trim();
  if(num.length!==10){ Swal.fire("Enter valid 10-digit number"); return; }

  fetch(`/search_employee?contact=${num}`)
    .then(res=>res.json())
    .then(data=>{
      if(!data.length){ Swal.fire("Employee not found"); document.getElementById("resultsContainer").classList.add("hidden"); return;}
      renderTable(data[0]);
    });
});

function renderTable(emp){
  const tbody = document.getElementById("resultsBody");
  tbody.innerHTML="";
  const tr = document.createElement("tr");

  ["name","applied_position","status","contact_no1","contact_no2"].forEach(col=>{
    const td = document.createElement("td");
    if(editableCols.includes(col)){
      const input = document.createElement("input");
      input.value = emp[col]||"";
      input.setAttribute("data-key",col);
      td.appendChild(input);
    } else td.textContent = emp[col]||"";
    tr.appendChild(td);
  });

  // Resume upload
  const tdResume = document.createElement("td");
  const resumeInput = document.createElement("input");
  resumeInput.type="file"; resumeInput.accept=".pdf,.doc,.docx";
  tdResume.appendChild(resumeInput);
  tr.appendChild(tdResume);

  // Action
  const tdAction = document.createElement("td");
  const saveBtn = document.createElement("button");
  saveBtn.textContent="Save";
  saveBtn.className="px-2 py-1 bg-green-600 text-white rounded";
  saveBtn.addEventListener("click",()=>{
    const updated={};
    editableCols.forEach(k=>{
      updated[k]=tr.querySelector(`[data-key='${k}']`).value;
    });
    fetch(`/update_employee/${emp.id}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(updated)
    }).then(res=>res.json()).then(r=>Swal.fire(r.success?"Success":"Error",r.message,r.success?"success":"error"));
  });
  tdAction.appendChild(saveBtn);
  tr.appendChild(tdAction);

  tbody.appendChild(tr);
  document.getElementById("resultsContainer").classList.remove("hidden");
}
</script>

</body>
</html>
